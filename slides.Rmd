---
title: "R Markdown"
author: "Maurits Evers, Sebastian Kurscheid"
date: "Version 1.0 (`r format(Sys.time(), '%d %B %Y')`)"
output:
  ioslides_presentation:
    widescreen: true
    smaller: true
    fig_width: 10.5
    fig_height: 5.5
    fig_caption: false
#    df_print: paged
    toc: yes
#    incremental: true
    css: styles.css
---

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  CommonHTML: {
    scale: 130
  }
});
</script>

<style>
  .col2 {
    columns: 2 200px;         /* number of columns and width in pixels*/
    -webkit-columns: 2 200px; /* chrome, safari */
    -moz-columns: 2 200px;    /* firefox */
  }
  .col3 {
    columns: 3 100px;
    -webkit-columns: 3 100px;
    -moz-columns: 3 100px;
  }
</style>


## Overview {.columns-2}

```{r echo=FALSE, out.width="450px"}
knitr::include_graphics("figures/RMarkdown_formats.png")
```


**What we will cover**

1. Prerequisities and how to get started
2. (R)Markdown 101
3. Customising R markdown elements and outputs
4. To interactivity and beyond!

<p style="margin-top:4em">

<div class="boxed">Interactive sessions.</div>


# Prerequisities and how to get started


## Prerequisities 1

**For this workshop**

Presenters: [Maurits Evers](mailto:maurits.evers@anu.edu.au), [Sebastian Kurscheid](mailto:sebastian.kurscheid@anu.edu.ai)  
Slides: [https://github.com/mevers/workshop_RMarkdown](https://github.com/mevers/workshop_RMarkdown)

<p style="margin-top:2em">

**What you should bring / have brought**

1. A laptop with a recent RStudio release already installed
2. A set of questions
3. (Optional) A sample text document for you to layout in RMarkdown

<p style="margin-top:2em">

**What you should be familiar with**

1. Basic R skills: Know what a `dataframe` is; how to produce a plot; how to inspect an element, ...
2. Basic Unix/Linux skills



## Prerequisities 2

**Important R packages**
```{r results="hide", message=FALSE, warning=FALSE}
pkg <- c("ggplot2", "rmarkdown", "knitr", "dplyr");
lapply(pkg, function(x) { if (!require(x, character.only = TRUE, quietly = TRUE)) {
  install.packages(x);
  require(x, quietly = TRUE)}
})
```

<p style="margin-top:2em">

**Example data**

We will use the `starwars` dataset from `dplyr`.
```{r}
head(starwars, n = 3);
```


## How to get started 1

**Create new RMarkdown (Rmd) document in RStudio**

1. **File $\rightarrow$ New File $\rightarrow$ R Markdown**

```{r echo=FALSE, out.width="800px"}
knitr::include_graphics("figures/new_RMarkdown_doc_1.png")
```


## How to get started 2
<ol start="2">
<li> **Specify output option**

```{r echo=FALSE, out.width="500px"}
knitr::include_graphics("figures/new_RMarkdown_doc_2.png")
```

<li> **Render** <img src="figures/button_knit.png" style="width:80px;">

## <font color="forestgreen">**Interactive session**</font> {#ex}
<ol start="0">
<li> If you need help with setting up RStudio and the necessary packages, this is the time...
<p style="margin-top:2em">
<li> Create a new R Markdown (Rmd) document in RStudio.
<li> Select PDF, HTML and Word as output option.
<li> Render the RMarkdown document to the corresponding output formats.
<li> Locate and open the final output file.
<li> Change the output format of an existing RMarkdown document
</ol>


## Under the hood

**Document conversion**

1. Rmd $\rightarrow$ PDF, HTML, Word uses `rmarkdown::render()` (note that `knitr::pandoc()` is deprecated)
2. `rmarkdown::render()` uses the universal document converter pandoc (installed as part of RStudio)

<p style="margin-top:2em">

For example, pandoc will translate
```markdown
# Header
```
into the following output-specific lines:

1. For HTML output
    ```html
    <h1>Header</h1>
    ```
2. For $\LaTeX$ output
    ```latex
    \section{Header}
    ```

# (R)Markdown 101


## (R)Markdown 101

Beware the different Markdown flavours: GitHub, R Markdown, vanilla Markdown, ...

<p style="margin-top:2em">

**Here: Focus on RMarkdown, and the following elements**

1. Headers
2. Emphasis: bold and italics
3. Lists: Ordered and unordered
4. Images and links
5. Blockquotes
6. Rules and line breaks

<p style="margin-top:2em">

**More details:**

* [Markdown basics](http://rmarkdown.rstudio.com/authoring_basics.html)
* [R Markdown Cheat Sheet](https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf)
* [Markdown Cheat Sheet](https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet)


## (R)Markdown 101 -- continued {.columns-2}

**Headers**
```markdown
# Header 1
## Header 2
### Header 3
#### Header 4
```

**Emphasis**
```markdown
*italic*, _italic_
**bold**, __bold__
```

**Lists**
```markdown
1. Level 1
    + Item 1
    + Item 2
2. Level 2
    + Item 3
    + Item 4
3. Level 3
```


**Images and links**
```markdown
![Alt text](URL)
[RStudio](https://www.rstudio.com/)
[email@email.com](mailto:email@email.com)
```

**Blockquote**
```markdown
> RStudio makes R easier to use. It includes a 
  code editor, debugging & visualization tools.
```

**Rules**
```markdown
----, ****
```

**Manual line breaks**  
End line with two or more whitespaces.
```markdown
Line 1 ends here,␣␣
line 2 start here.
```


## (R)Markdown 101 -- continued {.columns-2}

**Tables**  
Assemble list of words, and divide them with hyphens - (for the first row), and then separating each column with a pipe |.
```markdown
First Header | Second Header
------------ | -------------
Cell 1 | Cell 2
Cell 3 | cell 4
```

**Fenced code blocks**  
Lines wrapped within an environment with leading and tailing ```` ``` ```` are converted into a code block.  
An optional language identifier provides syntax highlighting.  

````markdown
```bash
echo "3 + 4"
```
````

R code blocks will be evaluated and printed (replace double with single curly brackets).

````markdown
```{{r}}
3 + 4
```
````

**Inline code**  
Use single backticks `` ` `` (delete curly brackets)
```markdown
`{r} summary(starwars)`
```


**Equations**  
The power of $\LaTeX$ (MathJax)
```markdown
$x = a$
$$ int_{x=0}^\infty dx \log{1+x} $$
```


## <font color="forestgreen">Interactive session</font> {#ex}

1. Experiment with different markdown elements in your RMarkdown document
2. Render the document and check the resulting output file
3. Are there any specific text elements you would like to typeset?


## (R) Markdown 101 -- Language-specific layouting

You can use language-specific expressions in RMarkdown documents.

For example:

1. In HTML documents, you can use
    + `<img src="path/to/image.png" style="width:200px;">` to place an image,
    + `<hr>` to place a horizontal rule,
    + `<ol start="10"><li>...</ol>` to create an ordered list,
    + most HTML code tags.
2. In PDF documents, you can use
    + `\includegraphics[width=\textwidth]{...}` to place an image,
    + `\begin{minipage}{.5\textwidth}...\end{minipage}` to fine-tune horizontal and vertical text/figure layout,
    + a lot of the $\LaTeX$ syntax.
    
Beware: A HTML statement won't be recognised if you render your RMarkdown file as a Word document.
    

# R Markdown elements


## R Markdown output {.columns-2}

```{r echo=FALSE, out.width="450px"}
knitr::include_graphics("figures/RMarkdown_formats.png")
```

**Growing list of output options**

1. [Word](http://rmarkdown.rstudio.com/word_document_format.html)
2. [PDF](http://rmarkdown.rstudio.com/pdf_document_format.html)
3. [HTML](http://rmarkdown.rstudio.com/html_document_format.html)
4. Presentation styles 
    + [ioslides](http://rmarkdown.rstudio.com/ioslides_presentation_format.html)
    + [slidify](http://slidify.org)
    + [reveal.js](http://rmarkdown.rstudio.com/revealjs_presentation_format.html)
    + [$\LaTeX$ beamer](http://rmarkdown.rstudio.com/beamer_presentation_format.html)
5. [Tufte handouts](http://rmarkdown.rstudio.com/tufte_handout_format.html)
5. [Bookdown](https://bookdown.org/yihui/bookdown/)


## The YAML header

```yaml
---
title: "Main title"
subtitle: "Subtitle"
author: "Firstname Lastname"
date: "07/08/2017"
output:
  word_document
---
```

<p style="margin-top:2em">

**Main keys**

1. Title and subtitle
2. Author (can have multiple authors as list for key `author`)
3. Date (can be R code, e.g. `format(Sys.time(), '%d %B %Y')`)
4. Output option: `html_document`, `pdf_document`, `word_document`, `ioslides_presentation`, `beamer_presentation`


## <font color="forestgreen">**Interactive session**</font> {#ex}
1. Make changes to the existing YAML header keys (title, author and date)
2. Add a subtitle to your document
2. Add multiple authors
3. Change the output from a Word document to a ioslides presentation


## Controlling the R output: Code chunk options

**Some useful options**

- `eval=FALSE`: Don't run code.
- `include=FALSE`: Run code but don't include the chunk in the output document.
- `echo=FALSE`: Don't show code, show results.
- `results='hide'`: Show code, don't show results.
- `message=FALSE`: Don't show any additional R messages.
- `error=FALSE`: Don't show R error messages.
- `warning=FALSE`: Don't show R warning messages.
- `cache=TRUE`: Use cached results (if available) until the code chunk is changed.
- `fig.width=7, fig.height=7`: Set actual figure width and height to 7 inches.
- `out.width=5, out.height=5`: Set output document figure width and height to 5 inches; if `fig.width, fig.height` are different, the output is scaled.  

<p style="margin-top:2em">

More chunk options can be found e.g. in the [R Markdown Reference Guide](https://www.rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf) and in [`knitr`'s documentation](https://yihui.name/knitr/options/).


## <font color="forestgreen">**Interactive session**</font> {#ex}
1. Write R code to show a barplot of how many characters participated in every Star Wars film.
2. Include the R code chunk without executing it.
1. Disable R output from an R code chunk.
3. Only show the output of an R code chunk.
4. Change the dimension of the (gg)plot.

<p style="margin-top:4em">

Hint:
```
# R code
# Extract all films per character
df <- cbind.data.frame(film = unlist(starwars$films));
ggplot(data = df, aes(film)) + geom_bar();
```


## Tables

**Different ways to present tabular data.**

<ol>
<li> Manual table creation  
```
First Header | Second Header
------------ | -------------
Cell 1 | Cell 2
Cell 3 | cell 4
```
<li> `knitr::kable()` (*all output*)
<li> `pander::pandoc.table()` (*all output*)
<li> `xtable::xtable()` (*only HTML and $\LaTeX$ output*)
<li> `stargazer::stargazer()` (*only HTML and $\LaTeX$ output*)

<p style="margin-top:2em">

<li> `DT::datatable()` (*only HTML output, interactive*)
</ol>


## Tables: Using `knitr::kable()`

```{r}
# Load R package knitr and show table
suppressMessages(library(knitr));
kable(starwars[1:6, 1:6])
```


## Tables: Using `DT::datatable()`

```{r}
# Load R package DT and show table
suppressMessages(library(DT));
DT::datatable(starwars[, 1:10], options = list(pageLength = 6, scrollX = TRUE));
```


## <font color="forestgreen">**Interactive session**</font> {#ex}

1. Write R code to show the first six columns of `starwars` in a Word document using a suitable R method.
2. Write R code to show the first 10 columns of `starwars` in a HTML document using a suitable R method.

<p style="margin-top:4em">

Note: Depending on the R method, you might have to install additional R packages, e.g. for `pander`:
```
# R code
# Install (if necessary) and load R package 'pander'
if (!require("pander", quietly = TRUE)) {
  install.packages("pander");
  require("pander", quietly = TRUE)}
```

## Static and interactive plots

1. base R
2. `ggplot2` from the `tidyverse`
2. `plotly`
3. D3 in R
    + `d3heatmp`
    + `scatterD3`
    + `networkD3`
    + `streamgraph`

**Load the necessary libraries**
```{r}
suppressMessages(library(scatterD3));
```


## Interactive plots: `plotly::ggplotly()`

```{r}
suppressMessages(library(plotly));
ggplotly(ggplot(starwars, aes(x = height, y = mass, label = name)) + geom_point(), height = 3);
```


## Interactive plots: `scatterD3::scatterD3()`

```{r, fig.height=4.5, fig.width=10}
scatterD3(x = starwars$height, y = starwars$mass, lab = starwars$name);
```


## Beyond interactive plots

R Markdown and shiny


## Link with github

...